image: python:latest

before_script:
  - apt-get update -q -y
  - apt-get install -y build-essential libgl1-mesa-glx kicad
  - python --version
  - pip install virtualenv
  - virtualenv venv
  - source venv/bin/activate
  - pip install -r requirements.txt
  - pip install git+https://github.com/CadQuery/cadquery.git  # Comment out once there is a production release of CadQuery 2.x on PyPI

ucon_17809:
  script:
    - ./generator.py --output_dir ./3dmodels --library 4UCON_17809 --enable-vrml True
    - mv ./3dmodels ./4UCON_17809
    # - ./validator.py --unvalidated_dir /tmp/3dmodels --validated_dir /usr/share/kicad/3dmodels/ > audit_log.txt
    # - cat ./audit_log.txt
  artifacts:
    paths:
      - 4UCON_17809
      # - audit_log.txt
  when: manual
  timeout: 6 hours
  tags:
    - kicad-ubuntu20.04

Altech:
  script:
    - ./generator.py --output_dir ./3dmodels --library Altech --enable-vrml True
    - mv ./3dmodels ./Altech
    # - ./validator.py --unvalidated_dir /tmp/3dmodels --validated_dir /usr/share/kicad/3dmodels/ > audit_log.txt
    # - cat ./audit_log.txt
  artifacts:
    paths:
      - Altech
      # - audit_log.txt
  when: manual
  timeout: 6 hours
  tags:
    - kicad-ubuntu20.04
